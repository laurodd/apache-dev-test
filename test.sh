set -ex

#no-cache to rebuild the image
#docker image build --no-cache . -t my-apache-with-datadome-module

#build the image based on the docker file
docker image build . -t my-apache-with-datadome-module

#run the image
docker run -d --rm --name myApache --env DATADOME_KEY=xd8do7ExR93X3Wh -p 8282:80 my-apache-with-datadome-module

#check the docker process running
docker ps

#simple curl test
for i in {1..5}; do echo "curling ${i}" ; curl "localhost:8282/product?Btwyv=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&locale=be_en&productsku=H041693CK1" ; done

#check logs of the container
docker logs myApache

#connect to the container to check the logs internally
#docker exec -it myApache bash

#simple ab test: seems like it cuts URL, like it does not support > 2048
#ab -n 1000 -c 10 http://localhost:8282//product?Btwyv=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&locale=be_en&productsku=H041693CK18
